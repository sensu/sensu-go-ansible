

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Sensu Go backend role &mdash; Sensu Go Ansible Collection  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sensu Go install role" href="install.html" />
    <link rel="prev" title="Sensu Go agent role" href="agent.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Sensu Go Ansible Collection
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Using Sensu Go Ansible Collection</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-sensu-go-6.html">Quickstart for Sensu Go 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-sensu-go-5.html">Quickstart for Sensu Go 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versioning_sensu_go_installation.html">Versioning Sensu Go installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensu_go_5_6_migration.html">Updating playbooks for Sensu Go 6</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../roles.html">Roles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="agent.html">Sensu Go agent role</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Sensu Go backend role</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-playbook">Example playbook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backend-configuration-options">Backend configuration options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#securing-sensu-go-backend">Securing Sensu Go backend</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#etcd-peer-communication">Etcd peer communication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backend-api">Backend API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dashboard">Dashboard</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tested-platforms-ci-cd">Tested Platforms (CI/CD)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Sensu Go install role</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Hacker's guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hacking.html">Developing Sensu Go Ansible Collection</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_policy.html">Release policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sensu Go Ansible Collection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../roles.html">Roles</a> &raquo;</li>
        
      <li>Sensu Go backend role</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/sensu/sensu-go-ansible/blob/master/docs/source/roles/backend.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sensu-go-backend-role">
<h1>Sensu Go backend role<a class="headerlink" href="#sensu-go-backend-role" title="Permalink to this headline">¶</a></h1>
<p>This role installs, configures and starts the <code class="docutils literal notranslate"><span class="pre">sensu-backend</span></code> service.</p>
<div class="section" id="example-playbook">
<h2>Example playbook<a class="headerlink" href="#example-playbook" title="Permalink to this headline">¶</a></h2>
<p>The most basic
<a class="reference download internal" download="" href="../_downloads/28b6551b258f4149f8fae840b0bd5477/backend.yaml"><code class="xref download docutils literal notranslate"><span class="pre">backend</span> <span class="pre">playbook</span></code></a> looks like
this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install, configure and run Sensu backend</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">backends</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sensu.sensu_go.backend</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">backend_config</span><span class="p">:</span>
      <span class="nt">log-level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">debug</span>
</pre></div>
</div>
<p>This playbook will install the latest stable version of the Sensu Go backend
and configure it. We can customize the backend’s configuration by adding more
options to the <em>backend_config</em> variable.</p>
</div>
<div class="section" id="backend-configuration-options">
<h2>Backend configuration options<a class="headerlink" href="#backend-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>The <em>backend_config</em> variable can contain any option that is valid for the
Sensu Go backend version we are installing. All valid options are listed in
the <a class="reference external" href="https://docs.sensu.io/sensu-go/latest/reference/backend/#configuration">official Sensu documentation</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Role copies the key-value pairs from the <em>backend_config</em> variable verbatim
to the configuration file. This means that we must copy the key names
<strong>exactly</strong> as they appear in the configuration reference. In a way, the
<em>backend_config</em> variable should contain a properly indented copy of the
<code class="docutils literal notranslate"><span class="pre">/etc/sensu/backend.yml</span></code> file.</p>
</div>
<p>Users of Sensu Go &gt;= 5.16 have two additional variables at their disposal that
control the first-time backend initialization:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 30%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cluster_admin_username</p></td>
<td><p>admin</p></td>
<td><p>Initial admin user to create when initializing backend for the first
time.</p></td>
</tr>
<tr class="row-odd"><td><p>cluster_admin_password</p></td>
<td><p><a class="reference external" href="mailto:P&#37;&#52;&#48;ssw0rd">P<span>&#64;</span>ssw0rd</a>!</p></td>
<td><p>Initial admin password to create when initializing backend for the
first time.</p></td>
</tr>
</tbody>
</table>
<p>On Sensu Go version below 5.16, these two variables have no effect since
default admin credentials are baked into the Sensu Go backend.</p>
</div>
<div class="section" id="securing-sensu-go-backend">
<h2>Securing Sensu Go backend<a class="headerlink" href="#securing-sensu-go-backend" title="Permalink to this headline">¶</a></h2>
<p>This role enables users to establish secure end-to-end communications of the
components that comprise the Sensu Go backend. The user needs to supply the
paths to the PKI files by placing the appropriate public and private key files
somewhere within the Ansible playbook search path. They then need to reference
these paths in the appropriate inventory variables, as described below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of the files referenced in each of the following subsections need to be
supplied. If even a single file is missing or not defined, the play will
fail. If none of the variables within a subsection is defined, those
services will be configured without the secure communication.</p>
</div>
<div class="section" id="etcd-peer-communication">
<h3>Etcd peer communication<a class="headerlink" href="#etcd-peer-communication" title="Permalink to this headline">¶</a></h3>
<p>To secure the etcd communication, create the appropriate files for the PKI
and define <strong>all</strong> of the following variables:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 30%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Examples</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>etcd_cert_file</p></td>
<td><p>files/pki/etcd-client.crt</p></td>
<td><p>Path to the certificate used for SSL/TLS connections <strong>to</strong> etcd. This
is a client certificate.</p></td>
</tr>
<tr class="row-odd"><td><p>etcd_key_file</p></td>
<td><p>files/pki/etcd-client.key</p></td>
<td><p>Path to the private key for the etcd client certificate file. Must be
unencrypted.</p></td>
</tr>
<tr class="row-even"><td><p>etcd_trusted_ca_file</p></td>
<td><p>files/pki/client-ca.crt</p></td>
<td><p>Path to the trusted certificate authority for the etcd client
certificates.</p></td>
</tr>
<tr class="row-odd"><td><p>etcd_peer_cert_file</p></td>
<td><p>files/pki/etcd-peer.crt</p></td>
<td><p>Path to the certificate used for SSL/TLS connections between peers.
This will be used both for listening on the peer address as well as
sending requests to other peers.</p></td>
</tr>
<tr class="row-even"><td><p>etcd_peer_key_file</p></td>
<td><p>files/pki/etcd-peer.key</p></td>
<td><p>Path to the peer certificate’s key. Must be unencrypted.</p></td>
</tr>
<tr class="row-odd"><td><p>etcd_peer_trusted_ca_file</p></td>
<td><p>files/pki/etcd-peer-ca.crt</p></td>
<td><p>Path to the trusted certificate authority for the peer certificates.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="backend-api">
<h3>Backend API<a class="headerlink" href="#backend-api" title="Permalink to this headline">¶</a></h3>
<p>To secure the Sensu Go backend API communication, create the appropriate files
for the PKI and define <strong>all</strong> of the following variables:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 30%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Examples</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>api_cert_file</p></td>
<td><p>files/pki/sensu-api.crt</p></td>
<td><p>Path to the certificate used to secure the Sensu Go API.</p></td>
</tr>
<tr class="row-odd"><td><p>api_key_file</p></td>
<td><p>files/pki/sensu-api.key</p></td>
<td><p>Path to the private key corresponding to the Sensu Go API certificate.
Must be unencrypted.</p></td>
</tr>
<tr class="row-even"><td><p>api_trusted_ca_file</p></td>
<td><p>files/pki/sensu-api-ca.crt</p></td>
<td><p>Path to the trusted certificate authority for the Sensu Go API
certificates.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dashboard">
<h3>Dashboard<a class="headerlink" href="#dashboard" title="Permalink to this headline">¶</a></h3>
<p>To secure the Sensu dashboard communication, create the appropriate files for the
PKI and define <strong>all</strong> of the following variables:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 30%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Examples</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dashboard_cert_file</p></td>
<td><p>files/pki/sensu-dashboard.crt</p></td>
<td><p>Path to the certificate used for SSL/TLS connections to the dashboard.</p></td>
</tr>
<tr class="row-odd"><td><p>dashboard_key_file</p></td>
<td><p>files/pki/sensu-dashboard.key</p></td>
<td><p>Path to the private key corresponding to the dashboard certificate.
Must be unencrypted.</p></td>
</tr>
</tbody>
</table>
<p>The role will automatically configure the dashboard endpoint to use HTTPS,
e.g.: <cite>https://localhost:3000</cite>.</p>
</div>
</div>
<div class="section" id="tested-platforms-ci-cd">
<h2>Tested Platforms (CI/CD)<a class="headerlink" href="#tested-platforms-ci-cd" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 25%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>OS</p></th>
<th class="head"><p>distribution</p></th>
<th class="head"><p>versions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>Linux</p></td>
<td><p>CentOS</p></td>
<td><p>7, 8</p></td>
</tr>
<tr class="row-odd"><td><p>RedHat</p></td>
<td><p>7, 8</p></td>
</tr>
<tr class="row-even"><td><p>Debian</p></td>
<td><p>9, 10</p></td>
</tr>
<tr class="row-odd"><td><p>Ubuntu</p></td>
<td><p>14.04, 16.04, 18.04</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="install.html" class="btn btn-neutral float-right" title="Sensu Go install role" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="agent.html" class="btn btn-neutral float-left" title="Sensu Go agent role" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, XLAB Steampunk.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>