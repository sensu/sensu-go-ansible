---
- name: Install sensu-go-agent binary
  include_role:
    name: install
  vars:
    components: [sensu-go-agent]

- name: Configure sensu-agent (/etc/sensu/agent.yml)
  template:
    src: agent.yml.j2
    dest: /etc/sensu/agent.yml
    # Keep this in sync with what the agent service is running as from packager
    owner: sensu
    group: sensu
    mode: '0600'
  notify: Restart agent
  tags: [configure_agent]

- name: Start sensu-agent
  service:
    name: sensu-agent
    state: started
    enabled: yes
  tags: [run_agent]
